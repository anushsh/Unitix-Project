<!DOCTYPE html>
<html>

<head>
    <% include head_imports.html %>
    <link href="//node_modules/bulma-calendar/dist/css/bulma-calendar.min.css" rel="stylesheet">
    <script src="//node_modules/bulma-calendar/dist/js/bulma-calendar.min.js"></script>

    <script type="text/javascript">
        function checkEvent() {

            // check for empty fields
            var name = $("#eventName").val()
            var type = $("#eventType").val()
            var group = $("#eventGroup").val()
            var showCount = $("#showCount").val()
            var shows = []

            if (validInput(name, type, group, showCount)) {
                listenForShows()
            } else {
                clearFields()
                invalidateFields()
                alert("Please fill all fields with legal values")
            }

        }

        function validInput(name, type, group, showCount) {
            return name != "" && type != "" && group != "" && showCount != "" && showCount > 0
        }

        function listenForShows() {
            // add the html for the shows first
            $("#showBox").removeClass("is-hidden")
            $("#showBox").addClass("is-active")
        }

        function postEvent(name, type, group, shows) {
            $.post("/create_event", {
                name: name,
                type: type,
                group: group,
                shows: shows
            }, function (data, status) {
                if (status == "success" && data) {
                    window.location.replace("/home");
                } else {
                    alert("There was an error.")
                    clearFields()
                }
            })
        }

        function clearFields() {
            $("#eventName").val("")
            $('#eventName').addClass('is-info');
            $("#eventType").val("")
            $('#eventType').addClass('is-info');
            $("#eventGroup").val("")
            $('#eventGroup').addClass('is-info');
            $("#showCount").val("")
            $('#showCount').addClass('is-info');

            // wipe show box
            $("#showBox").removeClass('is-active')
            $("#showBox").addClass('is-hidden')
        }

        function invalidateFields() {
            $('#eventGroup').removeClass('is-info');
            $('#eventGroup').addClass('is-danger');
            $('#eventName').removeClass('is-info');
            $('#eventName').addClass('is-danger');
            $('#eventType').removeClass('is-info');
            $('#eventType').addClass('is-danger');
            $('#showCount').removeClass('is-info');
            $('#showCount').addClass('is-danger');
        }


        $(document).ready(function () {
            clearFields()
            listenForShows()
            addCalendars()
        })

        function addCalendars() {
            var bulmaCalendar = BulmaCalendar.attach();
            // Initialize all input of type date
            var calendars = bulmaCalendar.attach('[type="date"]', options);

            // Loop on each calendar initialized
            for (var i = 0; i < calendars.length; i++) {
                // Add listener to date:selected event
                calendars[i].on('select', date => {
                    console.log(date);
                });
            }

            // To access to bulmaCalendar instance of an element
            var element = document.querySelector('#my-element');
            if (element) {
                // bulmaCalendar instance is available as element.bulmaCalendar
                element.bulmaCalendar.on('select', function (datepicker) {
                    console.log(datepicker.data.value());
                });
            }
        }
    </script>
</head>

<body>
    <% include header.html %>
    <div class="container has-text-centered">
        <h2 class="subtitle">Create Your Event</h2>
    </div>

    <div class="container">
        <div class="box">
            <div class="field">
                <label class="label">Group Name</label>
                <div class="control has-icons-left">
                    <input class="input" type="text" placeholder="Group Name" id="eventGroup">
                </div>
            </div>

            <div class="field">
                <label class="label">Event Name</label>
                <div class="control has-icons-left">
                    <input class="input" type="text" placeholder="Event Name" id="eventName">
                </div>
            </div>

            <div class="field">
                <label class="label">Event Type</label>
                <div class="control has-icons-left">
                    <input class="input" type="text" placeholder="Event Type" id="eventType">
                </div>
            </div>

            <div class="field">
                <label class="label">Number of Shows</label>
                <div class="control has-icons-left">
                    <input class="input" type="text" placeholder="#" id="showCount">
                </div>
            </div>

            <p class="help is-danger" id="incorrect_warning"></p>
            <div class="control">
                <button class="button is-link" onclick="checkEvent()">Create Event</button>
            </div>

            <div class="control">
                <button class="button is-link" onclick="clearFields()">Clear Fields</button>
            </div>
        </div>

        <div class="box" id="showBox">

            Show Details

            <div class="field">
                <label class="label">Start Date</label>
                <div class="control has-icons-left">
                    <input type="date" id="startDate">
                </div>

                <label class="label">End Date</label>
                <div class="control has-icons-left">
                    <input type="date" id="endDate">
                </div>
            </div>


        </div>
    </div>

</body>

</html>